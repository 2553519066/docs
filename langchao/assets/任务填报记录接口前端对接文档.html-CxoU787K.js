import{_ as s,c as a,e as t,o as p}from"./app-Buc66nam.js";const e={};function o(l,n){return p(),a("div",null,[...n[0]||(n[0]=[t(`<h1 id="任务填报记录接口前端对接文档" tabindex="-1"><a class="header-anchor" href="#任务填报记录接口前端对接文档"><span>任务填报记录接口前端对接文档</span></a></h1><h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h2><p>本文档提供了国家系统中任务填报记录相关的前端对接接口说明，包括创建任务填报记录、获取任务填报记录列表以及下载任务记录附件三个接口。</p><h2 id="接口列表" tabindex="-1"><a class="header-anchor" href="#接口列表"><span>接口列表</span></a></h2><h3 id="_1-创建任务填报记录" tabindex="-1"><a class="header-anchor" href="#_1-创建任务填报记录"><span>1. 创建任务填报记录</span></a></h3><h4 id="接口描述" tabindex="-1"><a class="header-anchor" href="#接口描述"><span>接口描述</span></a></h4><p>创建任务填报记录，用于记录用户填报任务的相关信息和上传的文件。</p><h4 id="请求信息" tabindex="-1"><a class="header-anchor" href="#请求信息"><span>请求信息</span></a></h4><ul><li><strong>URL</strong>: <code>/api/nationalsystem/create-task-log</code></li><li><strong>方法</strong>: <code>POST</code></li><li><strong>内容类型</strong>: <code>multipart/form-data</code></li><li><strong>认证</strong>: 需要（Bearer Token）</li></ul><h4 id="请求参数" tabindex="-1"><a class="header-anchor" href="#请求参数"><span>请求参数</span></a></h4><table><thead><tr><th>参数名</th><th>类型</th><th>必填</th><th>描述</th></tr></thead><tbody><tr><td>TaskCode</td><td>string</td><td>是</td><td>任务编号</td></tr><tr><td>TaskName</td><td>string</td><td>是</td><td>任务名称</td></tr><tr><td>FillTemplateType</td><td>int</td><td>是</td><td>填表模板类型（0-普通，1-带数）</td></tr><tr><td>FillMode</td><td>int</td><td>是</td><td>填表方式（0-普通，1-带数）</td></tr><tr><td>FillDescription</td><td>string</td><td>否</td><td>填报说明</td></tr><tr><td>File</td><td>IRemoteStreamContent</td><td>是</td><td>上传的文件</td></tr></tbody></table><h4 id="请求示例" tabindex="-1"><a class="header-anchor" href="#请求示例"><span>请求示例</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;TaskCode&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TASK202312001&quot;</span><span class="token punctuation">)</span></span>
<span class="line">formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;TaskName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2023年度数据统计任务&quot;</span><span class="token punctuation">)</span></span>
<span class="line">formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;FillTemplateType&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;FillMode&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;FillDescription&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;这是填报说明&quot;</span><span class="token punctuation">)</span></span>
<span class="line">formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;File&quot;</span><span class="token punctuation">,</span> fileObject<span class="token punctuation">)</span> <span class="token comment">// 文件对象</span></span>
<span class="line"></span>
<span class="line"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;/api/nationalsystem/create-task-log&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token string">&quot;Bearer &quot;</span> <span class="token operator">+</span> token</span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">body</span><span class="token operator">:</span> formData</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="响应结果" tabindex="-1"><a class="header-anchor" href="#响应结果"><span>响应结果</span></a></h4><p>返回创建的任务填报记录详情，包含系统生成的 ID 等信息。</p><table><thead><tr><th>字段名</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>id</td><td>Guid</td><td>记录 ID</td></tr><tr><td>taskCode</td><td>string</td><td>任务编号</td></tr><tr><td>taskName</td><td>string</td><td>任务名称</td></tr><tr><td>fillTemplateType</td><td>int</td><td>填表模板类型</td></tr><tr><td>fillMode</td><td>int</td><td>填表方式</td></tr><tr><td>fillDeptCode</td><td>Guid</td><td>填报部门 ID</td></tr><tr><td>fillDescription</td><td>string</td><td>填报说明</td></tr><tr><td>objectId</td><td>string</td><td>文件对象 ID</td></tr><tr><td>name</td><td>string</td><td>文件名称</td></tr><tr><td>path</td><td>string</td><td>文件路径</td></tr><tr><td>extension</td><td>string</td><td>文件扩展名</td></tr><tr><td>size</td><td>long</td><td>文件大小（字节）</td></tr><tr><td>fillPersonnel</td><td>string</td><td>填报人</td></tr><tr><td>fillDeptName</td><td>string</td><td>填报部门名称</td></tr><tr><td>creationTime</td><td>DateTime</td><td>创建时间</td></tr><tr><td>lastModificationTime</td><td>DateTime</td><td>最后修改时间</td></tr></tbody></table><hr><h3 id="_2-获取任务填报记录" tabindex="-1"><a class="header-anchor" href="#_2-获取任务填报记录"><span>2. 获取任务填报记录</span></a></h3><h4 id="接口描述-1" tabindex="-1"><a class="header-anchor" href="#接口描述-1"><span>接口描述</span></a></h4><p>获取任务填报记录列表，支持分页和条件筛选。</p><h4 id="请求信息-1" tabindex="-1"><a class="header-anchor" href="#请求信息-1"><span>请求信息</span></a></h4><ul><li><strong>URL</strong>: <code>/api/nationalsystem/task-fill-data-log</code></li><li><strong>方法</strong>: <code>GET</code></li><li><strong>内容类型</strong>: <code>application/json</code></li><li><strong>认证</strong>: 需要（Bearer Token）</li></ul><h4 id="请求参数-1" tabindex="-1"><a class="header-anchor" href="#请求参数-1"><span>请求参数</span></a></h4><table><thead><tr><th>参数名</th><th>类型</th><th>必填</th><th>描述</th></tr></thead><tbody><tr><td>TaskCode</td><td>string</td><td>否</td><td>任务编号</td></tr><tr><td>TaskName</td><td>string</td><td>否</td><td>任务名称</td></tr><tr><td>FillTemplateType</td><td>int?</td><td>否</td><td>填表模板类型</td></tr><tr><td>FillMode</td><td>int?</td><td>否</td><td>填表方式</td></tr><tr><td>FillDeptCode</td><td>Guid?</td><td>否</td><td>填报部门 ID</td></tr><tr><td>FillDescription</td><td>string</td><td>否</td><td>填报说明</td></tr><tr><td>ObjectId</td><td>string</td><td>否</td><td>文件对象 ID</td></tr><tr><td>Name</td><td>string</td><td>否</td><td>文件名称</td></tr><tr><td>Path</td><td>string</td><td>否</td><td>文件路径</td></tr><tr><td>Extension</td><td>string</td><td>否</td><td>文件扩展名</td></tr><tr><td>Size</td><td>long</td><td>否</td><td>文件大小</td></tr><tr><td>Sorting</td><td>string</td><td>否</td><td>排序字段</td></tr><tr><td>SkipCount</td><td>int</td><td>否</td><td>跳过记录数（默认 0）</td></tr><tr><td>MaxResultCount</td><td>int</td><td>否</td><td>最大返回记录数（默认 10）</td></tr></tbody></table><h4 id="请求示例-1" tabindex="-1"><a class="header-anchor" href="#请求示例-1"><span>请求示例</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;/api/nationalsystem/task-fill-data-log?TaskCode=TASK202312001&amp;SkipCount=0&amp;MaxResultCount=10&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token string">&quot;Bearer &quot;</span> <span class="token operator">+</span> token<span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/json&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="响应结果-1" tabindex="-1"><a class="header-anchor" href="#响应结果-1"><span>响应结果</span></a></h4><p>返回分页的任务填报记录列表。</p><table><thead><tr><th>字段名</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>totalCount</td><td>int</td><td>总记录数</td></tr><tr><td>items</td><td>array</td><td>记录列表</td></tr><tr><td>└─ id</td><td>Guid</td><td>记录 ID</td></tr><tr><td>└─ taskCode</td><td>string</td><td>任务编号</td></tr><tr><td>└─ taskName</td><td>string</td><td>任务名称</td></tr><tr><td>└─ fillTemplateType</td><td>int</td><td>填表模板类型</td></tr><tr><td>└─ fillMode</td><td>int</td><td>填表方式</td></tr><tr><td>└─ fillDeptCode</td><td>Guid</td><td>填报部门 ID</td></tr><tr><td>└─ fillDescription</td><td>string</td><td>填报说明</td></tr><tr><td>└─ objectId</td><td>string</td><td>文件对象 ID</td></tr><tr><td>└─ name</td><td>string</td><td>文件名称</td></tr><tr><td>└─ path</td><td>string</td><td>文件路径</td></tr><tr><td>└─ extension</td><td>string</td><td>文件扩展名</td></tr><tr><td>└─ size</td><td>long</td><td>文件大小（字节）</td></tr><tr><td>└─ fillPersonnel</td><td>string</td><td>填报人</td></tr><tr><td>└─ fillDeptName</td><td>string</td><td>填报部门名称</td></tr><tr><td>└─ creationTime</td><td>DateTime</td><td>创建时间</td></tr><tr><td>└─ lastModificationTime</td><td>DateTime</td><td>最后修改时间</td></tr></tbody></table><hr><h3 id="_3-下载任务记录附件" tabindex="-1"><a class="header-anchor" href="#_3-下载任务记录附件"><span>3. 下载任务记录附件</span></a></h3><h4 id="接口描述-2" tabindex="-1"><a class="header-anchor" href="#接口描述-2"><span>接口描述</span></a></h4><p>根据文件 ID 下载任务填报记录中上传的附件文件。</p><h4 id="请求信息-2" tabindex="-1"><a class="header-anchor" href="#请求信息-2"><span>请求信息</span></a></h4><ul><li><strong>URL</strong>: <code>/api/nationalsystem/download-task-log-file/{fileId}</code></li><li><strong>方法</strong>: <code>GET</code></li><li><strong>内容类型</strong>: <code>application/octet-stream</code></li><li><strong>认证</strong>: 需要（Bearer Token）</li></ul><h4 id="请求参数-2" tabindex="-1"><a class="header-anchor" href="#请求参数-2"><span>请求参数</span></a></h4><table><thead><tr><th>参数名</th><th>类型</th><th>必填</th><th>描述</th></tr></thead><tbody><tr><td>fileId</td><td>Guid</td><td>是</td><td>文件 ID（路径参数）</td></tr></tbody></table><h4 id="请求示例-2" tabindex="-1"><a class="header-anchor" href="#请求示例-2"><span>请求示例</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> fileId <span class="token operator">=</span> <span class="token string">&quot;3fa85f64-5717-4562-b3fc-2c963f66afa6&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/api/nationalsystem/download-task-log-file/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>fileId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token string">&quot;Bearer &quot;</span> <span class="token operator">+</span> token</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">blob</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 创建下载链接</span></span>
<span class="line">    <span class="token keyword">const</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">const</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    a<span class="token punctuation">.</span>href <span class="token operator">=</span> url</span>
<span class="line">    a<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token string">&quot;filename.ext&quot;</span> <span class="token comment">// 从接口响应或其他方式获取文件名</span></span>
<span class="line">    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></span>
<span class="line">    a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span></span>
<span class="line">    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="响应结果-2" tabindex="-1"><a class="header-anchor" href="#响应结果-2"><span>响应结果</span></a></h4><p>返回文件的二进制数据流。</p><table><thead><tr><th>字段名</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>-</td><td>byte[]</td><td>文件二进制数据</td></tr></tbody></table><h2 id="错误处理" tabindex="-1"><a class="header-anchor" href="#错误处理"><span>错误处理</span></a></h2><p>所有接口在请求失败时都会返回标准的 HTTP 状态码和错误信息。</p><table><thead><tr><th>状态码</th><th>描述</th></tr></thead><tbody><tr><td>200</td><td>请求成功</td></tr><tr><td>400</td><td>请求参数错误</td></tr><tr><td>401</td><td>未授权访问</td></tr><tr><td>403</td><td>禁止访问</td></tr><tr><td>404</td><td>资源不存在</td></tr><tr><td>500</td><td>服务器内部错误</td></tr></tbody></table><p>错误响应示例：</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;error&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ValidationError&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;请求参数验证失败&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;details&quot;</span><span class="token operator">:</span> <span class="token string">&quot;TaskCode字段不能为空&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项"><span>注意事项</span></a></h2><ol><li><strong>认证要求</strong>：所有接口都需要在请求头中包含有效的 Bearer Token 进行身份验证。</li><li><strong>文件上传限制</strong>：创建任务填报记录接口支持大文件上传，但建议单个文件不超过 100MB。</li><li><strong>文件类型</strong>：上传的文件可以是任何类型，但建议使用常见的办公文档格式（如.xlsx、.docx 等）。</li><li><strong>分页参数</strong>：获取任务填报记录接口使用 SkipCount 和 MaxResultCount 进行分页，默认每页返回 10 条记录。</li><li><strong>文件下载</strong>：下载任务记录附件接口返回的是文件的二进制数据，前端需要正确处理二进制流并触发浏览器下载。</li></ol><h2 id="示例代码" tabindex="-1"><a class="header-anchor" href="#示例代码"><span>示例代码</span></a></h2><p>以下是一个完整的示例，展示如何使用这三个接口完成一个典型的任务填报流程：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// 1. 创建任务填报记录</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createTaskFillLog</span><span class="token punctuation">(</span><span class="token parameter">taskData<span class="token punctuation">,</span> file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;TaskCode&quot;</span><span class="token punctuation">,</span> taskData<span class="token punctuation">.</span>taskCode<span class="token punctuation">)</span></span>
<span class="line">  formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;TaskName&quot;</span><span class="token punctuation">,</span> taskData<span class="token punctuation">.</span>taskName<span class="token punctuation">)</span></span>
<span class="line">  formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;FillTemplateType&quot;</span><span class="token punctuation">,</span> taskData<span class="token punctuation">.</span>fillTemplateType<span class="token punctuation">)</span></span>
<span class="line">  formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;FillMode&quot;</span><span class="token punctuation">,</span> taskData<span class="token punctuation">.</span>fillMode<span class="token punctuation">)</span></span>
<span class="line">  formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;FillDescription&quot;</span><span class="token punctuation">,</span> taskData<span class="token punctuation">.</span>fillDescription<span class="token punctuation">)</span></span>
<span class="line">  formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;File&quot;</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;/api/nationalsystem/create-task-log&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token string">&quot;Bearer &quot;</span> <span class="token operator">+</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">body</span><span class="token operator">:</span> formData</span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;创建任务填报记录失败&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2. 获取任务填报记录列表</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getTaskFillLogs</span><span class="token punctuation">(</span><span class="token parameter">taskCode<span class="token punctuation">,</span> page <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> pageSize <span class="token operator">=</span> <span class="token number">10</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> skipCount <span class="token operator">=</span> <span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize</span>
<span class="line">  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/api/nationalsystem/task-fill-data-log?TaskCode=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>taskCode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;SkipCount=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>skipCount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;MaxResultCount=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>pageSize<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token string">&quot;Bearer &quot;</span> <span class="token operator">+</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/json&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;获取任务填报记录失败&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 3. 下载任务记录附件</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">downloadTaskLogFile</span><span class="token punctuation">(</span><span class="token parameter">fileId<span class="token punctuation">,</span> fileName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/api/nationalsystem/download-task-log-file/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>fileId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token string">&quot;Bearer &quot;</span> <span class="token operator">+</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;下载文件失败&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">const</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">const</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  a<span class="token punctuation">.</span>href <span class="token operator">=</span> url</span>
<span class="line">  a<span class="token punctuation">.</span>download <span class="token operator">=</span> fileName</span>
<span class="line">  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></span>
<span class="line">  a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span></span>
<span class="line">  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 完整使用示例</span></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handleTaskSubmission</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 创建任务填报记录</span></span>
<span class="line">    <span class="token keyword">const</span> taskData <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">taskCode</span><span class="token operator">:</span> <span class="token string">&quot;TASK202312001&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">taskName</span><span class="token operator">:</span> <span class="token string">&quot;2023年度数据统计任务&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">fillTemplateType</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">fillMode</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">fillDescription</span><span class="token operator">:</span> <span class="token string">&quot;这是填报说明&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">const</span> fileInput <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;fileInput&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">const</span> file <span class="token operator">=</span> fileInput<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">const</span> createdLog <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">createTaskFillLog</span><span class="token punctuation">(</span>taskData<span class="token punctuation">,</span> file<span class="token punctuation">)</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;创建成功:&quot;</span><span class="token punctuation">,</span> createdLog<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 获取任务填报记录列表</span></span>
<span class="line">    <span class="token keyword">const</span> logs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getTaskFillLogs</span><span class="token punctuation">(</span>taskData<span class="token punctuation">.</span>taskCode<span class="token punctuation">)</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;记录列表:&quot;</span><span class="token punctuation">,</span> logs<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 下载第一个记录的附件</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>logs<span class="token punctuation">.</span>items<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> logs<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>objectId<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">await</span> <span class="token function">downloadTaskLogFile</span><span class="token punctuation">(</span>logs<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>objectId<span class="token punctuation">,</span> logs<span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;操作失败:&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;操作失败: &quot;</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 获取Token的示例函数（根据实际认证方式实现）</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;authToken&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="更新记录" tabindex="-1"><a class="header-anchor" href="#更新记录"><span>更新记录</span></a></h2><table><thead><tr><th>版本</th><th>日期</th><th>更新内容</th><th>更新人</th></tr></thead><tbody><tr><td>1.0</td><td>2023-12-05</td><td>初始版本，包含三个接口的详细说明</td><td>开发团队</td></tr><tr><td>1.1</td><td>2023-12-05</td><td>新增 TaskName 字段到创建任务填报记录和获取任务填报记录接口</td><td>开发团队</td></tr></tbody></table>`,54)])])}const i=s(e,[["render",o]]),u=JSON.parse('{"path":"/web/%E4%BB%BB%E5%8A%A1%E5%A1%AB%E6%8A%A5%E8%AE%B0%E5%BD%95%E6%8E%A5%E5%8F%A3%E5%89%8D%E7%AB%AF%E5%AF%B9%E6%8E%A5%E6%96%87%E6%A1%A3.html","title":"任务填报记录接口前端对接文档","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1766027024000,"contributors":[{"name":"2553519066","username":"","email":"2553519066@qq.com","commits":1}],"changelog":[{"hash":"73daec44bb6b31f18393acc147f033664e6c8003","time":1766027024000,"email":"2553519066@qq.com","author":"2553519066","message":"1"}]},"filePathRelative":"web/任务填报记录接口前端对接文档.md"}');export{i as comp,u as data};
